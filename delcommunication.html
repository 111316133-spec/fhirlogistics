<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>刪除 Communication</title>
</head>
<body>
  <h2>刪除 Communication</h2>
  
  <select id="commSelect">
    <option value="">載入中...</option>
  </select>
  <button id="deleteBtn">刪除</button>

  <p id="result"></p>

  <script>
    const FHIR_BASE_URL = "http://203.64.84.204:8080/fhir";

    // 載入所有 Communication ID 到下拉選單
    async function loadCommunications() {
      try {
        const res = await fetch(`${FHIR_BASE_URL}/Communication`);
        const data = await res.json();
        const select = document.getElementById("commSelect");
        select.innerHTML = "";

        if (data.entry && data.entry.length > 0) {
          data.entry.forEach(item => {
            const comm = item.resource;
            const option = document.createElement("option");
            option.value = comm.id;
            option.textContent = `ID: ${comm.id} | Status: ${comm.status}`;
            select.appendChild(option);
          });
        } else {
          const option = document.createElement("option");
          option.value = "";
          option.textContent = "沒有 Communication";
          select.appendChild(option);
        }
      } catch (err) {
        console.error(err);
        const select = document.getElementById("commSelect");
        select.innerHTML = `<option value="">載入失敗</option>`;
      }
    }

    // 刪除選中的 Communication
    async function deleteCommunication() {
      const select = document.getElementById("commSelect");
      const commId = select.value;
   
      try {
        const res = await fetch(`${FHIR_BASE_URL}/Communication/${commId}`, {
          method: "DELETE"
        });
        if (res.ok) {
          document.getElementById("result").textContent = `Communication ${commId} 已刪除`;
          // 刪除後重新載入下拉選單
          await loadCommunications();
        } else {
          const text = await res.text();
          document.getElementById("result").textContent = `刪除失敗: ${res.status} ${res.statusText}\n${text}`;
        }
      } catch (err) {
        document.getElementById("result").textContent = `刪除失敗: ${err}`;
      }
    }
    document.getElementById("deleteBtn").addEventListener("click", deleteCommunication);
    document.addEventListener("DOMContentLoaded", loadCommunications);
  </script>
</body>
</html>
