<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>刪除 Organization</title>
</head>
<body>
  <h2>刪除 Organization</h2>
  
  <select id="orgSelect">
    <option value="">載入中...</option>
  </select>
  <button id="deleteBtn">刪除</button>

  <p id="result"></p>

  <script>
    const FHIR_BASE_URL = "http://203.64.84.204:8080/fhir";

    // 載入所有 Organization 到下拉選單
    async function loadOrganizations() {
      try {
        const res = await fetch(`${FHIR_BASE_URL}/Organization`);
        const data = await res.json();
        const select = document.getElementById("orgSelect");
        select.innerHTML = "";

        if (data.entry && data.entry.length > 0) {
          data.entry.forEach(item => {
            const org = item.resource;
            const option = document.createElement("option");
            option.value = org.id;
            // 顯示 ID 與名稱
            const name = org.name || "無名稱";
            option.textContent = `ID: ${org.id} | Name: ${name}`;
            select.appendChild(option);
          });
        } else {
          const option = document.createElement("option");
          option.value = "";
          option.textContent = "沒有 Organization";
          select.appendChild(option);
        }
      } catch (err) {
        console.error(err);
        const select = document.getElementById("orgSelect");
        select.innerHTML = `<option value="">載入失敗</option>`;
      }
    }

    // 刪除選中的 Organization
    async function deleteOrganization() {
      const select = document.getElementById("orgSelect");
      const orgId = select.value;
    
      try {
        const res = await fetch(`${FHIR_BASE_URL}/Organization/${orgId}`, {
          method: "DELETE"
        });

        if (res.ok) {
          document.getElementById("result").textContent = `Organization ${orgId} 已刪除`;
          // 刪除後重新載入下拉選單
          await loadOrganizations();
        } else {
          const text = await res.text();
          document.getElementById("result").textContent = `刪除失敗: ${res.status} ${res.statusText}\n${text}`;
        }
      } catch (err) {
        document.getElementById("result").textContent = `刪除失敗: ${err}`;
      }
    }

    document.getElementById("deleteBtn").addEventListener("click", deleteOrganization);

    document.addEventListener("DOMContentLoaded", loadOrganizations);
  </script>
</body>
</html>
